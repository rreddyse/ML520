<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/onnxjs/dist/onnx.min.js"></script>
  <style>
    table, th, td {
      border: 1px solid;
    }

    #leftbox {
      float: left;
      width: 33%;
      height: 300px;
    }

    #middlebox {
      float: left;
      width: 33%;
      height: 300px;
    }

    #rightbox {
      float: right;
      width: 33%;
      height: 300px;
    }

    h1 {
      color: green;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1>Churn Prediction</h1>

  <div id="boxes1">
    <input type="text" id="box1" value="-0.37313433"> creditScore <br/>
    <input type="text" id="box2" value="0.41666667"> age <br/>
    <input type="text" id="box3" value="-1"> tenure<br/>
    <input type="text" id="box4" value="0.32679602"> balance <br/>
    <input type="text" id="box5" value="0"> noOfProducts <br/>
    <input type="text" id="box6" value="0.399455"> estimatedSalary <br/>
    <input type="text" id="box7" value="0.75"> NewAgt <br/>
    <input type="text" id="box8" value="-0.2"> CreditScore <br/>
    <input type="text" id="box9" value="0.5"> AgeScore <br/>
    <input type="text" id="box10" value="0.7"> BalanceScore <br/>
    <input type="text" id="box11" value="0.5"> EstimatedSalaryScore <br/>
    <input type="text" id="box12" value="0.399455"> NewEstimatedSalary <br/>
    <input type="text" id="box13" value="0"> geographyGermany <br/>
    <input type="text" id="box14" value="1"> geographySpain <br/>
    <input type="text" id="box15" value="0"> genderMale <br/>
    <input type="text" id="box16" value="1"> hascrcard <br/>
    <input type="text" id="box17" value="1"> isactivemember <br/>
  </div>

  <div>
    <input style="background-color: yellow" type="button" value="Run" onclick="runExample()"/>
  </div>

  <div id="boxes2">
    <h2>Inference</h2>
    <div id="predictions"></div>
  </div>

  <script>
    async function runExample() {
      // Retrieve user inputs from HTML input fields
      var x = [];
      for (let i = 1; i <= 17; i++) {
        x.push(parseFloat(document.getElementById('box' + i).value));
      }

      // Create an ONNX Tensor with user inputs
      let tensorX = new onnx.Tensor(x, 'float32', [1, 17]);

      let session = new onnx.InferenceSession();

      await session.loadModel("churn_prediction.onnx");
      let outputMap = await session.run([tensorX]);
      let outputData = outputMap.values().next().value;

      // Round the output value to the nearest integer
      let roundedOutput = Math.round(outputData.data[0]);

      // Display predictions on the web page
      let predictions = document.getElementById('predictions');
      predictions.innerHTML = `
        <hr> Churn Prediction Result: <br />
        <table>
          <tr>
            <td>Customer exited or not</td>
            <td id="result">${roundedOutput}</td>
          </tr>
        </table>
      `;
    }
  </script>

</body>
</html>

